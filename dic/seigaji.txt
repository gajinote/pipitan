がじです。
ブログ始めました。
とりあえずテスト投稿です。
つらつら更新していきます。

VPS契約にあたって私が選んだのはServersMan@vps
なぜかというと、理由は2つ
1．とにかく安い。
2．さくらインターネットを使っている人が多そうなのであえてさくらを避けた(へそ曲がりなのです）
ServersMan@VPSと契約するとメールが送られてきます。
私は使っていないサービスなのですが、いくつかパスワードが書かれているので念のため
パスワードを変更しておきます。
メールで初期パスワードを連絡してくるのはちょっと勘弁してほしい・・・
気を取り直してアップデート
続いてVPSでWordPress（ブログ）を動かし鯛？さんのブログの
このあたりを参考に、いらないサービスを停止
いろいろアタックしてくる人がいるらしいのでセキュリティを強化。
とりあえずrootログインの禁止とブルートフォースアタック防止にDenyHostsを設定
てもぐさんのページ
この辺も参考に
useradd でユーザーを追加して
useradd -G wheel gaji
visudoコマンドで追加したユーザーをsudo可能に設定。
公開鍵ファイルを作成して追加したユーザーアカウントに登録
(詳細は省略）
rootログインを禁止に設定。
denyhostsをインストールしようとしたらうまくいかなかったので
DenyHosts-2.6.tar.gz
をダウンロードしてtarコマンドで展開
でDenyHosts-2.6をインストール
ここまででやっと下準備完了。（ふう）
いろいろ勝手にリンク貼っちゃったけど許可取ったほうがいいのかしら？
次はwordpressのインストール

そもそもWordPressセットで契約すれば、こんな面倒な手間なんて必要ないのですが、勉強を兼ねてあえて手でインストールします。
まずはApacheとMySQL,PHPのインストールが必要ですが、EntryプランでもApacheはすでにインストール済みなので
MySQL, PHPの順でインストール作業をします。
Apacheの設定変更

/etc/httpd/conf/httpd.confをエディタで編集
一応Apache設定ファイルの文法をチェック
Syntax OKじゃなかったらhttpd.confファイルを見直し
MySQLの設定
1番目の行の意味は、ログの記録やホスト認証に名前解決をしない（IPアドレスを使用）
2番目の行の意味は、MySQLサーバーへの接続方法をソケットファイルのみでネットワーク接続しないという意味（同一サーバーなので）
3番目の行の意味はログを取得する。
次はMySQLの自動起動設定。
次回やっとWordPressのインストールへ。

肝心のWordPressインストールまでなかなかたどりつけません
自分でやってみてブログを書くのって結構大変なんだと実感しました。
さあ、ここからやっとWordPressのインストールに入ります。
このブログが立ち上がっているということはすでにWordPressはインストールできているわけで、若干うろ覚えながらできる限り書いてみます。
1)WordPress日本語版ダウンロード

まず、日本語版WordPress最新版をダウンロードします。(2013/8/13現在は3.6）
手元のPCにダウンロードして転送してもよいのですが、ここではwgetとunzipを使用することにします。
2)ファイルオーナーの変更

次にWordPressのオーナーを（apacheグループの）apacheユーザーに変更します。
これをやらないと後でプラグインのインストールとかWordPressのバージョンアップのときに怒られます。
3)wordpress用MySQLデータベース作成

MySQLにWordPress用のデータベースを作成します。
4)WordPress初期設定

やっとブラウザ登場
PCから「http://サーバーのアドレス/wordpress>にアクセス。
wp-config.phpファイルが存在しないようです
・・・
とか表示されますが、まだ設定していないため当たり前なので気にしません。
「設定ファイルを作成する」をクリック
「次に進みましょう」をクリック
初期設定項目入力画面になるので以下の様に記入します。
「作成する」をクリック
「インストール実行」をクリック
5)ブログタイトルとパスワードの設定
・・・wordpressのユーザー名ってadmin決め打ちなのね。これはまずい、後で対策しましょう。
ちなみに私はここで記入したパスワードが間違っていて自分のブログに入れなくなり、最初からやり直す羽目になりました。orz。
MySqlのテーブルも一回削除して再作成したよ。あほだ、とほほ。
最後に設定ファイルのオーナーとアクセス権を設定
ここまでで、一応WordPressでブログをかける様になりました。
次回はWordPressのセキュリティ向上を実施する予定。

WordPressのセキュリティ設定を向上！

前回も書きましたが、wordpressのユーザー名ってadmin決め打ちです。
Passwordのブルートフォースアタックを受けたらいつかは破られてしまいます。
ということで対策をいくつか打っておきます。
プラグインのインストール方法について

今回はWordPressのプラグインを使って対策をとります。

プラグインのインストールはWordPressの管理画面から
Pluginインストール.png(31336 byte)
でインストールしたいプラグイン名を入力してインストールします。
今回使用するのは3つ
■「Admin rename extended」プラグイン

AdminRename.png
管理者ユーザー名を自由に変更できるプラグインです。
管理メニューの「プラグイン」->「Admin rename extended」を選択して新しい管理者ユーザーを入力して「Update」をクリックするだけ。
管理者ユーザー名が[admin]から「入力したユーザー名」に変わります。
これだけでもかなり有効なはず。
なお、いまさらですがパスワードの長さは13文字以上のランダム文字列すると安全性がかなり高まります
■「limit login attempts」プラグイン

sshの設定でDenyHostsをインストールしましたが、似たようなのことをWordPressでも設定しておきたいです
アクセスのリトライ回数を制限するプラグインです。
初期値は
リトライは4回まで
4回のリトライに失敗した場合は20分間ログインを遮断
続けて4回の遮断が発生したら24時間のログイン遮断
リトライ回数をリセットするのは12時間
詳しくは書きませんが、私はデフォルトと設定を変えています。
■「Captcha」プラグイン

コメントスパムを防止するためにCaptchaをインストールします。
パスワード入力時に簡単な計算式を計算させるプラグインです。
漢数字も使えていい感じです。
時々自分でも計算間違えてログインに失敗したりすることがあるのはご愛嬌
漢字が入った時のパターンの理解が間違っているのかしら？
※今回はわにノートさんのページhttp://mag.torumade.nu/の
http:mag.torumade.nu/?p=11369を参考にさせていただきました。
ほとんど丸写しで申し訳ないです。
※あまりに丸写しで心苦しいので追記
■「StatPress Reloaded」アクセス解析プラグイン

アクセス解析の方法っていくつかあると思うのですが、現時点の私にはよくわからないのでWordPressのプラグインに頼ることにします。
検索で「StatPress Reloaded」と入力し「プラグインの検索」ボタンをクリックして見つかったらそのままインストール
英語のプラグインなので見やすくするために日本語化。
ECWorks Blog | 【WordPress】「StatPress」の日本語化ファイル公開
からプラグインを導入します。
解凍したzipファイルに含まれるファイルを
wp-content/plugins/statpress-reloaded/locale/直下に配置します。
テーマによってはうまく日本語化できないようなので
と名称変更したものもついでに配置しておきます。
来歴情報を見てみると・・・
なんかいろんな国からアクセスがありますね・・・こういうものなんでしょうか？

ちょっと息抜きして写真をUP
Yuyake
夕焼けが見事だったので。
SONY NEX-5N + SELP1650にて撮影
Sky01
こちらは青空
SONY NEX-5N + SELP1650にて撮影
色調を青に、コントラストとガンマをちょっといじりました。
もう少しうまくなりたいなぁ。

■WordPressインストール時にファイルオーナーの変更の意味

WordPressインストール時にファイルオーナーの変更
をしたと思うのですが、
これはapacheの設定ファイル/etc/httpd/conf/httpd.conf
の中で
User apache
Group apache
と指定されていて、WordPressはPHPでサイト内のコンテンツを動的に生成しているので
少なくともプラグインやテーマが保存される「/var/www/html/wordpress/wp-content/以下」はapache:apacheのユーザー所有ファイルじゃないとまずいんだと思うのですよ。
今回手動でwordpressをインストールしているのでデフォルトのファイル所有者はrootになっているわけで、ファール所有者をapache:apacheにしておかないとプラグインを入れたり、wordpressをバージョンアップするときにアクセス権がないとか、正しいユーザー名とパスワードを入れろとか怒られるわけですよ。
だからこれはやっておいたほうがいいんだと思うのです。
（実はVirtualBoxで試した時に一回やらかしています。スクリーンキャプチャ撮るの忘れたけど）
ところでユーザー所有者の変更じのユーザーとグループを変更するときの記票は「apache.apache」と「apache:apache」どっちがBeterなのかしらん？
※2013/8/22追記
どうやら「apache:apache」が正解のようです。
■DenyHostsインストールの後処理
DenyHostsをインストールした後でやっとかなきゃいけなかった作業を書き忘れてたので
それも書きます。
で再起動。これをやっとかないとdenyhostsのサービスが起動しないので意味ないという・・・書き忘れにもほどがありますね。
ま、README.txtに書いてあるそのままなんですけどね。
ほかにも書き忘れてるだろうなあ、どうしよう。
■おまけ：Topページの設定ファイルを配置
このブログのTopページはhttp://seigaji.info/wordpressですが、http://seigaji.info/でたどってきた人がブログページにたどり着けないので簡単な転送用のindex.htmlを/var/www/html/配下に置いておきます。

サイトのテーマを変更
もともと使用していたテーマはデフォルトで入っていたTwenty Thirteenというもの。
これはちょっと明るすぎるのと文字が大きすぎてどうにも私の趣味に合いませんでした。
変更前のイメージ
before
3列カラムですっきりしたテーマを検索してみたところ「StartupWP 」というのが目に留まったので入れてみました。
変更後のイメージ
after
後はカレンダーを追加したりちょこちょこカスタマイズしてみました。
タイトル文字色と数字フォントがいまいちで気になりますが、これはCSSを編集すればよいのかしらん？
もうちょっとwordpressとPHPを勉強してみます。

初めてのガジェットネタです。
このブログに持っていること自体書くのが初めてなのですが、Dropad A8というアンドロイドタブレットを持っています。
長年使っていましたがさすがに限界なのでさようならすることに決めました。
壊すの覚悟でいろいろいじっていてかなり勉強になったのですが、
最初に、ACアダプターがいきなり断線したところからケチがつき始めました。
仕方なく家にあったありもののACアダプターに変換コネクタをつけて無理やり使っていたのですが、＋－の接続を間違えて充電回路がお亡くなりになり、
図のような簡単な充電回路を
下記のように内部に入れて
無理やり充電してました。
ACアダプタが9V、トランジスタのPN接合ダイオードでのドロップが0.6V、バッテリーがリチウムポリマー2セルタイプなのでMax8.4Vだから、まあいいだろうと。←もっとちゃんとしなさい。
(^^;)\
しかし、最近は電源ジャックそのものがいかれてきたらしく、使い続けるのが困難な状態に・・・
仕方ないので全初期化して廃棄します。
OSの焼き直しを何度もしたり、オーバークロックカーネル入れたり、カスタムファームを焼いてみたり、いろいろ勉強になったものです。
#技適通ってないのでWiLAN使うのに制約があるためAppのインストールとかは若干苦労しましたが。
ちなみにこいつの内部メモリはマイクロSDの4GBなので、念のため外して廃棄するつもりです。

デフォルト設定のままで10件のエントリーの全文が表示されていて見苦しかったのでちまちま見栄えを変更するだけで大したことをしていなかったのですが、改めて
このブログ、実は今までバックアップを取っていませんでした。（わ、言っちゃった）
地道に手作業でバックアップを取ってもいいのですが、楽したいなぁと思って探していたところ、WordPressのDBやプラグインファイルをDropboxにバックアップしてくれる便利なプラグイン、BackWPupというのを見つけました。
WordPressの管理画面から「backwpup」と入力して
最初に表示されるプラグインをインストールします。
注意:このプラグインは現在使用している WordPress のバージョンではテストされていません。
とか出るけど気にせず作業しちゃいます。<-ホントはいけない。
同様に管理画面からBackWPup->Add New Jobを選択して新しいジョブを作成します。
ジョブ名、実行タスク、圧縮形式などが選べます。
さらにバックアップ先としては
・任意のフォルダ
・電子メール
・FTP
・Dropbox
・Amazon S3サービス
・MicrosoftAzure
・Rackspace Cloud
・SugerSync
が選べます。
ここではDropboxを選択してみました。
手順をキャプチャするのを忘れちゃいましたが、BackWPupをDropboxに認証させると
Filedeletionというのはバックアップファイルをいくつまで残すかですね。
デフォルトの数字15は結構大きいので注意が必要です。
Scheduleの管理タグからバックアップスケジュールも指定できます。
頻度はお好きに設定してください。私の場合は週1回程度。
試しに実行してみたところ、時間にして70秒程度で9MbyteほどのバックアップファイルがDropboxに作成されました。
初めてのガジェットネタです。
このブログに持っていること自体書くのが初めてなのですが、Dropad A8というアンドロイドタブレットを持っています。
長年使っていましたがさすがに限界なのでさようならすることに決めました。
壊すの覚悟でいろいろいじっていてかなり勉強になったのですが、最初に、ACアダプターがいきなり断線したところからケチがつき始めました。
仕方なく家にあったありもののACアダプターに変換コネクタをつけて無理やり使っていたのですが、＋－の接続を間違えて充電回路がお亡くなりになり、図のような簡単な充電回路を下記のように内部に入れて無理やり充電してました。
ACアダプタが9V、トランジスタのPN接合ダイオードでのドロップが0.6V、バッテリーがリチウムポリマー2セルタイプなのでMax8.4Vだから、まあいいだろうと。←もっとちゃんとしなさい。
(^^;)\
しかし、最近は電源ジャックそのものがいかれてきたらしく、使い続けるのが困難な状態に・・・
仕方ないので全初期化して廃棄します。
OSの焼き直しを何度もしたり、オーバークロックカーネル入れたり、カスタムファームを焼いてみたり、いろいろ勉強になったものです。
#技適通ってないのでWiLAN使うのに制約があるためAppのインストールとかは若干苦労しましたが。
ちなみにこいつの内部メモリはマイクロSDの4GBなので、念のため外して廃棄するつもりです。
サイトのテーマを変更
もともと使用していたテーマはデフォルトで入っていたTwenty Thirteenというもの。
これはちょっと明るすぎるのと文字が大きすぎてどうにも私の趣味に合いませんでした。
3列カラムですっきりしたテーマを検索してみたところ「StartupWP 」というのが目に留まったので入れてみました。
後はカレンダーを追加したりちょこちょこカスタマイズしてみました。
タイトル文字色と数字フォントがいまいちで気になりますが、これはCSSを編集すればよいのかしらん？
もうちょっとwordpressとPHPを勉強してみます。
いくつか書き忘れていたことを自分用に一応メモを残します。
■WordPressインストール時にファイルオーナーの変更の意味
WordPressインストール時にファイルオーナーの変更
# chown -R apache.apache /var/www/html/wordpress 
をしたと思うのですが、
これはapacheの設定ファイル/etc/httpd/conf/httpd.conf
の中で
    User apache
    Group apache 
と指定されていて、WordPressはPHPでサイト内のコンテンツを動的に生成しているので少なくともプラグインやテーマが保存される「/var/www/html/wordpress/wp-content/以下」はapache:apacheのユーザー所有ファイルじゃないとまずいんだと思うのですよ。
今回手動でwordpressをインストールしているのでデフォルトのファイル所有者はrootになっているわけで、ファール所有者をapache:apacheにしておかないとプラグインを入れたり、wordpressをバージョンアップするときにアクセス権がないとか、正しいユーザー名とパスワードを入れろとか怒られるわけですよ。
だからこれはやっておいたほうがいいんだと思うのです。（実はVirtualBoxで試した時に一回やらかしています。スクリーンキャプチャ撮るの忘れたけど）
ところでユーザー所有者の変更じのユーザーとグループを変更するときの記票は「apache.apache」と「apache:apache」どっちがBeterなのかしらん？
※2013/8/22追記
どうやら「apache:apache」が正解のようです。
■DenyHostsインストールの後処理
DenyHostsをインストールした後でやっとかなきゃいけなかった作業を書き忘れてたので
それも書きます。
    # cd /etc/init.d
    # ln -s /usr/share/denyhosts/daemon-control denyhosts
    # chkconfig –add denyhosts 
で再起動。これをやっとかないとdenyhostsのサービスが起動しないので意味ないという・・・書き忘れにもほどがありますね。
ま、README.txtに書いてあるそのままなんですけどね。
ほかにも書き忘れてるだろうなあ、どうしよう。
■おまけ：Topページの設定ファイルを配置
このブログのTopページはhttp://seigaji.info/wordpressですが、http://seigaji.info/でたどってきた人がブログページにたどり着けないので簡単な転送用のindex.htmlを/var/www/html/配下に置いておきます。
ちょっと息抜きして写真をUP
夕焼けが見事だったので。
SONY NEX-5N + SELP1650にて撮影
こちらは青空
SONY NEX-5N + SELP1650にて撮影
色調を青に、コントラストとガンマをちょっといじりました。
もう少しうまくなりたいなぁ。

